<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chủ - Nguyệt Truyện</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS của bạn giữ nguyên */
        .story-card {
            transition: transform 0.3s ease;
        }
        .story-card:hover {
            transform: translateY(-5px);
        }
        /* Thêm style cho nội dung truyện chi tiết (nếu cần) */
        .prose img { max-width: 100%; height: auto; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="/" class="flex items-center"><img src="https://nguyettruyen.net/images/logo.png" alt="Nguyệt Truyện" class="h-12"></a>
            <nav>
                </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <div id="main-content">
            <section class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Truyện hot</h2>
                    <a href="#" class="text-purple-600 hover:text-purple-800">Xem tất cả <i class="fas fa-chevron-right ml-1 text-sm"></i></a>
                </div>
                <div id="hot-stories-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    <p>Đang tải danh sách truyện, vui lòng chờ...</p>
                </div>
            </section>

            </div>

        <div id="story-detail-container" class="hidden prose lg:prose-xl max-w-none">
            </div>
    </main>

    <footer class="bg-gray-800 text-white py-10">
        </footer>


    <script>
        // --- 1. CẤU HÌNH ---
        // !!! RẤT QUAN TRỌNG: Thay URL này bằng URL API trên Hugging Face của bạn
        const API_URL = 'https://khanhtho3110-khanhthont.hf.space';

        // --- 2. LẤY CÁC PHẦN TỬ HTML ---
        const mainContent = document.getElementById('main-content');
        const storyDetailContainer = document.getElementById('story-detail-container');
        const hotStoriesContainer = document.getElementById('hot-stories-container');

        // --- 3. CÁC HÀM XỬ LÝ ---

        /**
         * Hàm này tạo ra mã HTML cho một thẻ truyện (story card)
         * @param {object} story - Một đối tượng truyện từ API
         * @returns {string} - Chuỗi HTML của thẻ truyện
         */
        function createStoryCardHTML(story) {
            // Lấy phần slug (ví dụ: "cay-hong-cua-ba-noi") từ link đầy đủ
            const slug = story.link.split('/').pop();

            return `
                <div class="story-card bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg">
                    <a href="/truyen/${slug}" 
                       class="story-link" 
                       data-original-url="${story.link}">
                        <img src="${story.image}" alt="${story.title}" class="w-full h-48 object-cover">
                        <div class="p-3">
                            <h3 class="font-semibold text-gray-800 mt-1 line-clamp-2">${story.title}</h3>
                            <p class="text-xs text-gray-500 mt-1">${story.author || ''}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-purple-600">${story.category || ''}</span>
                                <span class="text-xs text-gray-500">${story.chapters || ''}</span>
                            </div>
                        </div>
                    </a>
                </div>
            `;
        }

        /**
         * Hàm gọi API để lấy danh sách truyện và hiển thị ra trang chủ
         */
        async function fetchAndDisplayStories() {
            try {
                // Gọi đến endpoint /hot-stories của API
                const response = await fetch(`${API_URL}/hot-stories`);
                if (!response.ok) {
                    throw new Error(`Lỗi mạng: ${response.status}`);
                }
                const data = await response.json();

                // Dùng map để biến mỗi object truyện thành một chuỗi HTML, sau đó nối tất cả lại
                hotStoriesContainer.innerHTML = data.stories.map(createStoryCardHTML).join('');
                
                // Sau khi đã có các thẻ truyện trên trang, gắn sự kiện click cho chúng
                addClickListenersToStoryLinks();

            } catch (error) {
                hotStoriesContainer.innerHTML = '<p class="text-red-500">Đã xảy ra lỗi khi tải danh sách truyện. Vui lòng thử lại sau.</p>';
                console.error('Lỗi fetchAndDisplayStories:', error);
            }
        }

        /**
         * Hàm này sẽ được gọi khi người dùng click vào một truyện
         * @param {string} slug - Phần định danh của truyện trên URL
         * @param {string} originalUrl - Link gốc của truyện để API cào nội dung
         */
        async function showStoryDetail(slug, originalUrl) {
            // Ẩn danh sách truyện, hiện khung chứa nội dung chi tiết
            mainContent.classList.add('hidden');
            storyDetailContainer.classList.remove('hidden');
            storyDetailContainer.innerHTML = '<p>Đang tải nội dung truyện, vui lòng chờ...</p>';

            // Thay đổi URL trên thanh địa chỉ mà không cần tải lại trang
            history.pushState(null, '', `/truyen/${slug}`);
            
            // --- CẦN BẠN NÂNG CẤP API ---
            // Bạn cần tạo một endpoint mới trên API, ví dụ /story-content
            // để cào nội dung từ `originalUrl` và trả về.
            // Hiện tại chúng ta sẽ giả lập nó.
            
            // GIẢ LẬP: Thay thế bằng fetch thật đến API /story-content của bạn
            setTimeout(() => {
                 storyDetailContainer.innerHTML = `
                    <button id="back-button" class="mb-4 px-4 py-2 bg-purple-600 text-white rounded">&larr; Quay lại danh sách</button>
                    <h1 class="text-3xl font-bold">${slug.replace(/-/g, ' ')}</h1>
                    <p>Nội dung chi tiết của truyện sẽ được hiển thị ở đây. Bạn cần nâng cấp API để có endpoint cào nội dung từ link: ${originalUrl}</p>
                 `;
                 // Gắn sự kiện cho nút quay lại
                 document.getElementById('back-button').addEventListener('click', showHomePage);
            }, 1000); // Giả lập độ trễ mạng 1 giây
        }
        
        /**
         * Hàm để quay về trang chủ từ trang chi tiết truyện
         */
        function showHomePage() {
            // Ẩn khung chi tiết, hiện lại danh sách truyện
            storyDetailContainer.classList.add('hidden');
            mainContent.classList.remove('hidden');
            // Thay đổi URL về trang chủ
            history.pushState(null, '', '/');
        }

        /**
         * Tìm tất cả các link truyện và gắn sự kiện click
         */
        function addClickListenersToStoryLinks() {
            const storyLinks = document.querySelectorAll('.story-link');
            storyLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    // Ngăn trình duyệt chuyển trang theo cách thông thường
                    event.preventDefault(); 
                    
                    const slug = this.getAttribute('href').split('/').pop();
                    const originalUrl = this.dataset.originalUrl;
                    
                    // Gọi hàm để hiển thị nội dung chi tiết
                    showStoryDetail(slug, originalUrl);
                });
            });
        }
        
        // --- 4. KHỞI CHẠY ---
        // Ngay khi trang được tải, gọi hàm để lấy và hiển thị danh sách truyện
        document.addEventListener('DOMContentLoaded', fetchAndDisplayStories);
        
    </script>
</body>
</html>